<Window x:Class="AdminClientWpf.Views.DashboardWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:AdminClientWpf.ViewModels"
        Title="DnD Admin • Dashboard" Width="1100" Height="700"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource Bg0Brush}">
    <Window.Resources>
        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="RowBackground" Value="#1C142B"/>
            <Setter Property="AlternatingRowBackground" Value="#160F23"/>
            <Setter Property="BorderBrush" Value="#3B2A55"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
        </Style>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#2A1E3D"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="BorderBrush" Value="#3B2A55"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,0,0,18">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Vertical">
                <TextBlock Text="Admin dashboard" Style="{StaticResource TitleText}"/>
                <TextBlock Margin="0,6,0,0" Foreground="{StaticResource SubTextBrush}"
                           Text="Csak admin felhasználók - felhasználó kezelés"/>
                <TextBlock Margin="0,6,0,0" Foreground="{StaticResource SubTextBrush}"
                           Text="{Binding AdminLabel}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <Button Content="Refresh" Width="120" Margin="0,0,12,0" Command="{Binding RefreshCommand}"/>
                <Button Content="Logout" Width="120" Command="{Binding LogoutCommand}"/>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" CornerRadius="16" Background="{StaticResource CardBrush}" BorderBrush="#3B2A55" BorderThickness="1" Padding="12">
                <DataGrid ItemsSource="{Binding Users}"
                          SelectedItem="{Binding SelectedUser}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          IsReadOnly="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="*" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="160" IsReadOnly="True"/>
                        <DataGridComboBoxColumn Header="Role"
                                                SelectedItemBinding="{Binding Role, UpdateSourceTrigger=PropertyChanged}"
                                                ItemsSource="{Binding DataContext.RoleOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                                                Width="120"/>
                        <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive, UpdateSourceTrigger=PropertyChanged}" Width="90"/>
                        <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd}" Width="120" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Last login" Binding="{Binding LastLoginAt, StringFormat=yyyy-MM-dd HH:mm}" Width="160" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <StackPanel Grid.Column="1" Margin="18,0,0,0">
                <Border CornerRadius="16" Background="{StaticResource CardBrush}" BorderBrush="#3B2A55" BorderThickness="1" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Selected user" FontSize="18" FontWeight="SemiBold"/>
                        <TextBlock Margin="0,10,0,0" Foreground="{StaticResource SubTextBrush}" Text="{Binding SelectedUser.Email}"/>
                        <TextBlock Margin="0,4,0,0" Foreground="{StaticResource SubTextBrush}" Text="{Binding SelectedUser.Username}"/>

                        <StackPanel Margin="0,18,0,0">
                            <TextBlock Text="Role" Style="{StaticResource HintText}"/>
                            <ComboBox ItemsSource="{Binding RoleOptions}" SelectedItem="{Binding SelectedUser.Role}" Margin="0,6,0,0"/>
                        </StackPanel>

                        <StackPanel Margin="0,14,0,0">
                            <CheckBox Content="Active" IsChecked="{Binding SelectedUser.IsActive}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,18,0,0">
                            <Button Content="Update role" Width="140" Margin="0,0,12,0" Command="{Binding UpdateRoleCommand}"/>
                            <Button Content="Update status" Width="140" Command="{Binding UpdateStatusCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <Border Margin="0,16,0,0" CornerRadius="16" Background="{StaticResource Bg1Brush}" BorderBrush="#3B2A55" BorderThickness="1" Padding="14">
                    <StackPanel>
                        <TextBlock Foreground="{StaticResource DangerBrush}"
                                   Text="{Binding ErrorMessage}"
                                   TextWrapping="Wrap"
                                   Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <TextBlock Foreground="{StaticResource GoldBrush}"
                                   Margin="0,6,0,0"
                                   Text="{Binding StatusMessage}"
                                   TextWrapping="Wrap"
                                   Visibility="{Binding HasStatus, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
